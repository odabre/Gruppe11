<html>  
    <head>
        <title>Total Dissolved Solids</title>
        <link rel="stylesheet" href="{{ url_for('static', filename='main_style.css') }}">
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    </head>
    <body>
        <div class="main">
            <aside class = "sidebar">
                <a href="{{url_for('run')}}">
                    <img src="{{url_for('static', filename='487BDFE8-69CE-4ACF-858A-F14382F42528_4_5005_c.jpeg') }}" alt="Logo" class="logo">
                </a>
                <ul>
                    <li>
                        <a href="#" class="dropdown-toggle">Sensorer</a>
                        <ul class="dropdown">
                            <li><a href="/ph">PH</a></li>
                            <li><a href="/temperatur">Temperatur</a></li>
                            <li><a href="/sensor">Total dissolved solids</a></li>
                            <li><a href="/turbiditet">Turbiditet</a></li>
                        </ul>
                    <li><a href="/nr2">Gå til Nr2</a></li>
                    <div class = "link-container">
                        <a href="https://www.facebook.com/MausundFeltstasjon/" target="_blank">
                            <img src="{{url_for('static', filename='facebook.jpg') }}" alt="Facebook" class="facebook">
                        </a>
                        <a href="https://www.instagram.com/mausundfeltstasjon/" target="_blank">
                            <img src="{{url_for('static', filename='instagram.jpg') }}" alt="Instagram" class="instagram">
                        </a>
                        <a href="https://twitter.com/MausundF" target="_blank">
                            <img src="{{url_for('static', filename='twitter.jpg') }}" alt="X" class="twitter">
                        </a>
                    </div>
            </aside>
            <div class = "content">
                <h1>Last ned Pandas CSV</h1>
                    <table border="1">
                        <tbody id="data-table">
                            <!-- Data will be populated here -->
                        </tbody>
                    </table>
                    <a href="/download-csv">Klikk her for å laste ned tds data</a>
                    <canvas id = "myChart" width="200" height = "100"></canvas>

            </div>
        </div>

        <script>
            const ctx = document.getElementById("myChart").getContext("2d");
            const myChart = new Chart(ctx, {
                type:"line",
                data:{
                    labels:["januar", "februar", "mars" , "april"],
                    datasets:[{
                        label:"total dissolved solides",
                        data:[25,100,50,10,80],
                        borderColor: "rgba(75,192,192, 1)",
                        borderWidth:1,
                        fill: false
                    }]
                },
                options:{
                    scales:{
                         y:{
                            beginAtZero:true,
                            title:{
                                display: true,
                                text: "total disolved solids (ppm)"
                            }
                        },
                        x:{
                            title:{
                                display: true,
                                text: "tid"
                            }
                        }
                    }
                }
            });
            
                function update_chart() {
                    fetch("/update")
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok ' + response.statusText);
                        }
                        return response.json();
                    })
                    .then(datagraf => {
                        // Update the chart with new data
                        myChart.data.labels = datagraf.tds.map((_, index) => index + 1); // Set x-axis labels to index (1, 2, 3, ...)
                        myChart.data.datasets[0].data = datagraf.tds; // Assuming 'tds' contains your y-axis data
                        // Log received data for debugging
                        console.log('Data mottatt:', datagraf);
                        myChart.update(); // Update the chart
                        })
                    fetch('/download-tds-data')
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok ' + response.statusText);
                        }
                        return response.json();
                    })
                .catch(error => console.error("Feil ved henting av data:", error));
                }
                // Run the function on page load and update every 5 seconds
                setInterval(update_chart, 5000);
                
        </script>
    </body>
</html>